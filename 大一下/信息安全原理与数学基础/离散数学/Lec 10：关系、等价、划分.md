# Lec 10：关系、等价、划分
## 1 关系
### 1. 1 二元关系
* 空关系：∅
* 全关系：A×B
* 相等关系： $E_A = \{< x, x > ｜x ∈ A\}$
* 设 $R$ 为 $A$ 到 $B$ 的二元关系（$R ⊆ A×B$）
  * $xRy$ 表示 $< x, y >∈ R$
  * $¬xRy$ 表示 $< x, y >∉ R$
* 定义域（Domain）
  *  $Dom(R) = \{x｜x ∈ A ∧ ∃y\,\,(< x, y >∈ R)\}$
* 值域（Range）
  * $Ran(R) = \{y｜y ∈ B ∧ ∃x\,\,(< x, y >∈ R)\}$
* 称 $A$ 为 $R$ 的前域，$B$ 为 $R$ 的陪域




### 1. 2 关系的表示方法
* 集合表示法
* 关系图法
  * 前域和陪域都是有限集合
  * 一般的关系图，有向箭头表示元素之间存在关系
  * 可以表示前域和陪域相同的关系图
* 关系矩阵法
  * 前域和陪域都是有限集合
  * 设关系 $R ⊆ A×B$，$A = \{a_1, … , a_m\}$，$ B = \{b_1, … , b_n\}$，则关系 $R$ 的关系矩阵 $M_R$ 满足：
    * $m_{ij}=1$ 当且仅当 $a_i\,R\,b_j$
    * $m_{ij}=0$ 当且仅当 $¬a_i\,R\,b_j$
### 1. 3 关系运算
* 参与关系运算的两个关系应该具有相同的前域和陪域
* 作为集合的关系运算
  * 并运算：$R ∪ S = \{< x, y > |\,xRy ∨ xSy\}$
  * 交运算：$R ∩ S = \{< x, y > |\,xRy ∧ xSy\}$
  * 差运算：$R − S = \{< x, y > |\,xRy ∧ ¬xSy\}$
  * 补运算：$ \overline R = A×B − R = \{< x, y > |\,¬xRy\}$
* 对应的关系矩阵运算
  * 并运算：$M_{R ∪ S} = M_R ∨ M_S$ 
  * 交运算：$M_{R ∩ S} = M_R ∧ M_S$ 
  * 补运算：$M_{\overline R} = \overline {M_R}$
  * 差运算：$M_{R-S} = M_R ∧ M_{\overline S}$
* 关系的逆运算（converse）
  * $R^{-1} = \{< y, x > |\, xRy\}$
  * $M_{R^{-1}}=M^T_R$
  * 性质
    * $(R^{-1})^{-1} = R$
    * $ \overline {R^{-1}} = (\overline {R})^{-1}$
    * $R ⊆ S$ 当且仅当$R^{-1} ⊆ S^{-1}$
    * 分配律：$(R\#S)^{-1}=R^{-1}\#S^{-1}$
* 关系合成运算（composition）
  * $R$ 为 $A$ 到 $B$ 的二元关系，$R ⊆ A×B$，$S$ 为 $B$ 到 $C$ 的二元关系，$S ⊆ B×C$，则：
    * $R ∘ S = \{< x, z > ｜x ∈ A ∧ z ∈ C ∧ ∃y(y ∈ B ∧ xRy ∧ ySz)\}$
    * 简化形式：$R ∘ S = \{< x, z > ｜∃y(xRy ∧ ySz)\}$
  *  $R ∘ S ⊆ A×C$，是 $A$ 到 $C$ 的二元关系
  * 对应关系矩阵的乘法
  * 性质
    * 不满足交换律
    * 结合律：$R ∘ (S ∘ T) = (R ∘ S) ∘ T$ 
    * 分配律
      * $R ∘ (S ∪ T) = (R ∘ S) ∪ (R ∘ T)$ 
      * $(S ∪ T) ∘ R = (S ∘ R) ∪ (T ∘ R)$ 
      * $R ∘ (S ∩ T) ⊆ (R ∘ S) ∩ (R ∘ T)$
      * $(S ∩ T) ∘ R ⊆ (S ∘ R) ∩ (T ∘ R)$
    * $(R ∘ S)^{-1}= S^{-1} ∘ R^{-1}$
* 关系的幂运算
  * $R^n = R ∘ ⋯ ∘ R$ （n个R合成）
  * $R^0 = E_A$
  * 设集合 $A$ 的基数为 $n$ ，$R$ 是 $A$ 上的二元关系，则存在满足 $0 ≤ i < j ≤ 2^{n^2}$的自然数 $i,j$ ，使得 $R_i=R_j$
### 1. 4 关系特性
#### 1. 4. 1 基本概念
| 关系类型     | 定义                                       | 关系图描述                               | 关系矩阵描述               |
|--------------|--------------------------------------------|----------------------------------------|----------------------------|
| **自反关系**<br>(reflexive)         | $∀x (x ∈ A → xRx)$                          | 每个节点都有环                         | 对角线全为1               |
| **反自反关系**<br>(irreflexive)     | $∀x (x ∈ A → ¬xRx)$                         | 每个节点都没有环                       | 对角线全是0               |
| **对称关系**<br>(symmetric)         | $∀x∀y (x, y ∈ A ∧ xRy → yRx)$               | 两个节点之间有边的就有反向边           | 对称矩阵                   |
| **反对称关系**<br>(antisymmetric)   | $∀x∀y (x, y ∈ A ∧ xRy ∧ yRx → x = y)$       | 两个节点之间只能有一条单向边           | 若$i≠j$且$c_{ij}=1$，则$c_{ji}=0$     |
| **传递关系**<br>(transitive)        | $∀x∀y∀z (x, y, z ∈ A ∧ xRy ∧ yRz → xRz)$    | 如果存在边x到y和y到z，则有边x到z       | （无特殊矩阵特征）         |
* 所有非空集合上的空关系都是反自反、对称、反对称、传递的
* 所有非空集合上的全关系是自反、对称、传递的
* 所有非空集合上的相等关系是自反、对称、反对称、传递的
* 空集合上的空关系是自反的，同时也是反自反的
* $A$ 上的相等关系 $E_A$ 既是对称的，又是反对称的
#### 1. 4. 2 相关定理
* $R$ 自反 $↔$ $E_A ⊆ R$
* $R$ 反自反 $↔$ $E_A ∩ R ⊆ ∅$
* $R$ 对称 $↔$ $R ⊆ R^{-1}$ 
* $R$ 反对称 $↔$ $R ∩ R^{-1}⊆ E_A$
* $R$ 传递 $↔$ $R^2 ⊆ R$  

#### 1. 4. 3 运算封闭性
* 所有5个特性对交运算封闭
* 自反、反自反、对称性对并运算封闭
* 反自反、对称、反对称性对差运算封闭
* 对称性对补运算封闭
* 所有5个特性对求逆运算封闭
* 仅自反对合成运算封闭
  
## 2 等价
1. 等价关系（equivalent relation）
   * $A$ 上的自反、对称、传递的二元关系
2. 等价类（equivalent class）
   * 定义
     * 设 $R$ 为 $A$ 上的等价关系，对于每个 $a ∈ A$，$a$ 的等价类记作 $[a]_R$，简记为 $[a]$，则有 $[a]_R = \{x |x ∈ A ∧ xRa\}$
     * $a$ 称作 $[a]_R$ 的代表元素
     * 等价类是 $A$ 的子集，每个代表元素确定一个等价类
   * 性质
     * $A$ 上的任何一个等价关系 $R$ ，任何一个元素 $a$ ，等价类 $[a]_R$ 都不是空集
     * 同一个等价类可能有不同的代表元素，不同的元素可能有相同的等价类
   * 等价类定理
     * $R$ 是 $A$ 上的等价关系，则任意的 $a, b ∈ A$，$aRb$ 当且仅当 $[a]_R = [b]_R$
     * $R$ 是 $A$ 上的等价关系，则任意的 $a, b ∈ A$，要么 $[a]_R = [b]_R$，要么 $[a]_R ∩ [b]_R =∅$

## 3 划分
### 3. 1 基本概念
* 划分是满足下列条件的集合 $A$ 的子集族 $\pi$
  * 不空：$∀B (B ∈ \pi → B ≠ ∅)$
  * 不漏：$∪ \pi = A$ 
  * 不交：$∀B∀B'\,\, (B ∈ \pi ∧ B' ∈ \pi ∧ B ≠ B' → B ∩ B'= ∅$
* $\pi$ 中的元素称为划分的单元
* 特别约定 $A = ∅$ 时只有划分 $∅$
* 等价关系与划分一一对应
### 3. 2 划分的粗细
* 细于：$\pi_1$的每一个单元都包含于$\pi_2$的某个单元，表示为  $\pi_1≤ \pi_2$
* 真细于：$\pi_1≤ \pi_2$ 且$\pi_1 ≠ \pi_2$，表示为$\pi_1< \pi_2$
* $\pi_1，\pi_2$ 分别是等价关系 $R_1，R_2$ 对应的划分，那么 $R1 ⊆ R2 ↔ \pi_1 ≤ \pi_2$
* 越小（包含二元组较少）的等价关系对应越细的划分
* 最小的等价关系是相等关系 $E_A$，对应最细的划分，每个单元仅含一个元素
* 最大的等价关系是全关系，对应最粗的划分，仅有一个单元
### 3. 3 划分的运算
* 积划分运算
  * $ \pi_1 · \pi_2$ 是细于 $\pi_1$ 和 $\pi_2$ 的最粗划分
  * $\pi_1 · \pi_2$ 是等价关系 $R_1∩R_2$ 对应的划分
* 和划分运算
  * $ \pi_1 + \pi_2$ 是粗于 $\pi_1$ 和 $\pi_2$ 的最细划分
  * $ \pi_1 + \pi_2$ 是等价关系 $t(R_1 ∪ R_2)$ 对应的划分
> **二元关系 $R$ 的传递闭包 $t(R)$**
> * $t(R)$是传递的， $R ⊆ t(R)$
> * 对于 $A$ 上的任意一个具有传递性质且包含 $R$ 的关系 $R'$， $t(R) ⊆ R'$
> * 和划分对应于等价关系并运算结果的传递闭包，而非等价关系的并运算
* 商集（quotient sets）
  * $R$ 是 $A$ 上的等价关系，称 $A$ 的划分 ${[a]_R｜a ∈ A}$ 为 $A$ 的 $R$ 商集，记作 $A/R$
  * 每一个划分 $\pi$ 均为 $A$ 上的一个商集，相应的商集的和、积对应于划分的和与积
  * $A/(R_1 ∩ R_2) = A/R_1 \,· A/R_2$
  * $A/t(R_1 ∪ R_2) = A/R_1+A/R_2$



